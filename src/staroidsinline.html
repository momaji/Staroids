<!DOCTYPE html>
<html>
<head>
	<title>Asteroids by Mo</title>
</head>
<body>
	<canvas id="canvas" width="600" height="600" style="border: 1px solid black;"> </canvas>
	<script>
		const FPS = 30; //frames per second
		const SHIP_SIZE = 30; // ship height in pixels
		const TURN_SPEED = 360; //Turn speed in degrees per second
		const SHIP_THRUST = 5; //acceleration of the ship in pixels per second per second
		const FRICTION = 0.7; // friction coefficient of space (0 = none 1 = lots)

		/** @type {HTMLCanvasElement} */

		var cvs = document.getElementById("canvas"); //sets up canvas
		var ctx = cvs.getContext("2d"); //sets up context

		var firethrustX = 0;
		var firethrustY = 0;
		var shipPosX = 0;
		var shipPosY = 0;

		var ship = {
			x: cvs.width/2,
			y: cvs.height/2,
			r: SHIP_SIZE/2, //radius of ship
			a: 90/180 * Math.PI,   //heading of ship converted to radians
			rot: 0,
			thrushing: false,
			thrust: {
				x: 0,
				y: 0
			},
			fire: false
		}

		var bullet = {
			x: 0,
			y: 0,
			rot: 0,
			baseVel: 0,
			extraVel: 10,
			thrust: {
				x: 0,
				y: 0
			}
		}

		Bullet = function(){
		  this.x=0;
			this.y=0;
			this.rot=0;
			this.base=0;
			this.extraVel={
				x: 10,
				y: 10
			};

			this.update = function(){
				this.x += (this.extraVel.x + this.base.x) * Math.cos(this.rot)/FPS;
				this.y += (this.extraVel.y + this.base.y) * Math.sin(this.rot)/FPS;
			};

			this.init = function(ship){
				this.x=ship.x;
				this.y=ship.y;
				this.rot=ship.a;
				this.base=ship.thrust;

				if (this.base.x<0){
					this.extraVel.x*=-1;
				}
				if (this.base.y<0){
					this.extraVel.y*=-1;
				}
			};

		  this.timeOut = function(){}; //Countdown until bullet disappears
		};

		//create bullets on space bar press, have some intial velocity and are relative to the ship
		//can only be a certain number of bullets on screen/bullets can only go so far

		//set up event handlers
		document.addEventListener("keydown", keyDown);
		document.addEventListener("keyup", keyUp);


		//set up the game loop
		setInterval(update, 1000/FPS);

		function keyDown(ev){
			switch(ev.keyCode){
				case 37: //left arrow (rotate ship left)
					ship.rot = TURN_SPEED/180*Math.PI/FPS; //converts turn speed to radians then gets per frame speed of that
					break;
				case 38: //up arrow (thrusts ship forward)
					ship.thrusting = true;
					break;
				case 39: //right arrow (rotate ship right)
					ship.rot = -TURN_SPEED/180*Math.PI/FPS;
					break;
				case 32: //spacebar press (fire bullet)
					bullet.rot = ship.rot;
					ship.fire =  true;
					firethrustX = ship.thrust.x;
					firethrustY = ship.thrust.y;
					shipPosX = ship.x;
					shipPosY = ship.y;
					break;
			}
		}

		function keyUp(ev){
			switch(ev.keyCode){
				case 37: //left arrow (stop rotating ship left)
					ship.rot = 0; //converts turn speed to radians then gets per frame speed of that
					break;
				case 38: //up arrow (stop thrusting ship forward)
					ship.thrusting = false;
					break;
				case 39: //right arrow (stop rotating ship right)
					ship.rot = 0;
					break;
				case 32: //spacebar released (delay for next bullet before we set fire to false)
					ship.fire = false;
					bullet.thrust.x =20;
					bullet.thrust.y =20;
					break;
			}
		}

		function update(){
			//draw space
			ctx.fillStyle = "black";
			ctx.fillRect(0,0,cvs.width, cvs.height);

			//thrust the ship
			if (ship.thrusting) {
				ship.thrust.x+= SHIP_THRUST * Math.cos(ship.a)/FPS; //cos = adj/hyp
				ship.thrust.y-= SHIP_THRUST * Math.sin(ship.a)/FPS; //sin = opp/hyp

				//draw the thruster
				ctx.strokeStyle = "yellow";
				ctx.fillStyle = "red";
				ctx.lineWidth = SHIP_SIZE / 10;
				ctx.beginPath();
				ctx.moveTo(// rear left of the ship
					ship.x - ship.r * (2/3*Math.cos(ship.a) + 0.5*Math.sin(ship.a)),
					ship.y + ship.r * (2/3*Math.sin(ship.a) - 0.5*Math.cos(ship.a))
				);

				ctx.lineTo( //rear centre behind the ship behind
					ship.x - ship.r * 6/3*Math.cos(ship.a),
					ship.y + ship.r * 6/3*Math.sin(ship.a)
				);

				ctx.lineTo( //rear right of ship
					ship.x - ship.r * (2/3*Math.cos(ship.a) - 0.5*Math.sin(ship.a)),
					ship.y + ship.r * (2/3*Math.sin(ship.a) + 0.5*Math.cos(ship.a))
				);

				ctx.closePath();
				ctx.fillStyle = "red";

				ctx.stroke();ship.fire
			} else {
				ship.thrust.x -= FRICTION * ship.thrust.x/FPS;
				ship.thrust.y -= FRICTION * ship.thrust.y/FPS;
			}

			//draw triangular ship
			ctx.strokeStyle = "white";
			ctx.lineWidth = SHIP_SIZE / 20;
			ctx.beginPath();
			ctx.moveTo(// nose of the ship
				ship.x + 4/3 * ship.r * Math.cos(ship.a),
				ship.y - 4/3 * ship.r * Math.sin(ship.a)
			);

			ctx.lineTo( //rear left of ship
				ship.x - ship.r * (2/3*Math.cos(ship.a) + Math.sin(ship.a)),
				ship.y + ship.r * (2/3*Math.sin(ship.a) - Math.cos(ship.a))
			);

			ctx.lineTo( //rear right of ship
				ship.x - ship.r * (2/3*Math.cos(ship.a) - Math.sin(ship.a)),
				ship.y + ship.r * (2/3*Math.sin(ship.a) + Math.cos(ship.a))
			);

			ctx.closePath();

			ctx.stroke();

			//rotate ship
			ship.a += ship.rot;

			//move the ship
			ship.x += ship.thrust.x;
			ship.y += ship.thrust.y;

			//handle edge of screen
			if (ship.x < 0 - ship.r){
				ship.x = cvs.width + ship.r;
			} else if (ship.x > cvs.width + ship.r){
				ship.x = 0 - ship.r;
			}
			if (ship.y < 0 - ship.r){
				ship.y = cvs.height + ship.r;
			} else if (ship.y > cvs.height + ship.r){
				ship.y = 0 - ship.r;
			}

			//centre dot
			ctx.fillStyle = "red";
			ctx.fillRect(ship.x-1, ship.y - 1, 2, 2);

			//ship fires bullet
			if(ship.fire){ //this has to be change
				bullet.thrust.x += firethrustX;
				bullet.thrust.y += firethrustY;
				ctx.arc(shipPosX + bullet.thrust.x, shipPosY + bullet.thrust.y, 5, 0, 2*Math.PI);
				ctx.stroke();
			}
		}
	</script>

</body>
</html>
