<!DOCTYPE html>
<html>
<head>
	<title>Asteroids by Mo</title>
</head>
<body>
	<canvas id="canvas" width="600" height="600" style="border: 1px solid black;"> </canvas>
	<script>
		const FPS = 30; //frames per second
		const SHIP_SIZE = 30; // ship height in pixels
		const TURN_SPEED = 360; //Turn speed in degrees per second
		const SHIP_THRUST = 5; //acceleration of the ship in pixels per second per second
		const FRICTION = 0.7; // friction coefficient of space (0 = none 1 = lots)

		/** @type {HTMLCanvasElement} */

		var cvs = document.getElementById("canvas"); //sets up canvas
		var ctx = cvs.getContext("2d"); //sets up context

		var ship = {
			x: cvs.width/2,
			y: cvs.height/2,
			r: SHIP_SIZE/2, //radius of ship
			a: 90/180 * Math.PI,   //heading of ship converted to radians
			rot: 0,
			thrushing: false,
			thrust: {
				x: 0,
				y: 0
			},
			fire: false
		}

		//create bullets on space bar press, have some intial velocity and are relative to the ship
		//can only be a certain number of bullets on screen/bullets can only go so far

		//set up event handlers
		document.addEventListener("keydown", keyDown);
		document.addEventListener("keyup", keyUp);


		//set up the game loop
		setInterval(update, 1000/FPS);

		function keyDown(ev){
			switch(ev.keyCode){
				case 37: //left arrow (rotate ship left)
					ship.rot = TURN_SPEED/180*Math.PI/FPS; //converts turn speed to radians then gets per frame speed of that
					break;
				case 38: //up arrow (thrusts ship forward)
					ship.thrusting = true;
					break;
				case 39: //right arrow (rotate ship right)
					ship.rot = -TURN_SPEED/180*Math.PI/FPS;
					break;
				case 32: //spacebar press (fire bullet)
					ship.fire =  true;
					break;
			}
		}

		function keyUp(ev){
			switch(ev.keyCode){
				case 37: //left arrow (stop rotating ship left)
					ship.rot = 0; //converts turn speed to radians then gets per frame speed of that
					break;
				case 38: //up arrow (stop thrusting ship forward)
					ship.thrusting = false;
					break;
				case 39: //right arrow (stop rotating ship right)
					ship.rot = 0;
					break;
				case 32: //spacebar released (delay for next bullet)
					ship.fire = false;
					break;
			}
		}

		function update(){
			//draw space
			ctx.fillStyle = "black";
			ctx.fillRect(0,0,cvs.width, cvs.height);

			//ship fires bullet
			if(ship.fire){
				ctx.beginPath();
				ctx.arc(100,75,50,0,2*Math.PI);
				//ctx.stroke();
				ctx.moveTo(// nose of the ship
					ship.x + 4/3 * ship.r * Math.cos(ship.a),
					ship.y - 4/3 * ship.r * Math.sin(ship.a)
				);
				ctx.stroke();

			}

			//thrust the ship
			if (ship.thrusting) {
				ship.thrust.x+= SHIP_THRUST * Math.cos(ship.a)/FPS; //cos = adj/hyp
				ship.thrust.y-= SHIP_THRUST * Math.sin(ship.a)/FPS; //sin = opp/hyp

				//draw the thruster
				ctx.strokeStyle = "yellow";
				ctx.fillStyle = "red";
				ctx.lineWidth = SHIP_SIZE / 10;
				ctx.beginPath();
				ctx.moveTo(// rear left of the ship
					ship.x - ship.r * (2/3*Math.cos(ship.a) + 0.5*Math.sin(ship.a)),
					ship.y + ship.r * (2/3*Math.sin(ship.a) - 0.5*Math.cos(ship.a))
				);

				ctx.lineTo( //rear centre behind the ship behind
					ship.x - ship.r * 6/3*Math.cos(ship.a),
					ship.y + ship.r * 6/3*Math.sin(ship.a)
				);

				ctx.lineTo( //rear right of ship
					ship.x - ship.r * (2/3*Math.cos(ship.a) - 0.5*Math.sin(ship.a)),
					ship.y + ship.r * (2/3*Math.sin(ship.a) + 0.5*Math.cos(ship.a))
				);

				ctx.closePath();
		document.addEventListener("keyup", keyUp);
				ctx.fillStyle = "red";


				ctx.stroke();
			} else {
				ship.thrust.x -= FRICTION * ship.thrust.x/FPS;
				ship.thrust.y -= FRICTION * ship.thrust.y/FPS;
			}

			//draw triangular ship
			ctx.strokeStyle = "white";
			ctx.lineWidth = SHIP_SIZE / 20;
			ctx.beginPath();
			ctx.moveTo(// nose of the ship
				ship.x + 4/3 * ship.r * Math.cos(ship.a),
				ship.y - 4/3 * ship.r * Math.sin(ship.a)
			);

			ctx.lineTo( //rear left of ship
				ship.x - ship.r * (2/3*Math.cos(ship.a) + Math.sin(ship.a)),
				ship.y + ship.r * (2/3*Math.sin(ship.a) - Math.cos(ship.a))
			);

			ctx.lineTo( //rear right of ship
				ship.x - ship.r * (2/3*Math.cos(ship.a) - Math.sin(ship.a)),
				ship.y + ship.r * (2/3*Math.sin(ship.a) + Math.cos(ship.a))
			);

			ctx.closePath();

			ctx.stroke();

			//rotate ship
			ship.a += ship.rot;

			//move the ship
			ship.x += ship.thrust.x;
			ship.y += ship.thrust.y;

			//handle edge of screen
			if (ship.x < 0 - ship.r){
				ship.x = cvs.width + ship.r;
			} else if (ship.x > cvs.width + ship.r){
				ship.x = 0 - ship.r;
			}
			if (ship.y < 0 - ship.r){
				ship.y = cvs.height + ship.r;
			} else if (ship.y > cvs.height + ship.r){
				ship.y = 0 - ship.r;
			}

			//centre dot
			ctx.fillStyle = "red";
			ctx.fillRect(ship.x-1, ship.y - 1, 2, 2);
		}






	</script>

</body>
</html>
