<!DOCTYPE html>
<html>
<head>
	<title>Asteroids by Mo</title>
</head>
<body>
	<canvas id="canvas" width="600" height="600" style="border: 1px solid black;"> </canvas>
	<script>
		const FPS = 30; //frames per second
		const SHIP_SIZE = 30; // ship height in pixels
		const TURN_SPEED = 360; //Turn speed in degrees per second
		const SHIP_THRUST = 1; //acceleration of the ship in pixels per second per second
		const FRICTION = 0.7; // friction coefficient of space (0 = none 1 = lots)
		const MAX_SPEED = 15; //Maximum ship speed
		const MIN_SPEED = 0.000001; //minimum speed
		const MAX_ACC = 3;

		/** @type {HTMLCanvasElement} */

		var cvs = document.getElementById("canvas"); //sets up canvas
		var ctx = cvs.getContext("2d"); //sets up context

		var Key = {
			//  Key.isDown(Key.UP); "undefined" if up and pressed duration if down
		  pressed: {},

		  LEFT: 37,
		  UP: 38,
		  RIGHT: 39,
		  DOWN: 40,
		  SPACE: 32,

		  isDown: function(keyCode){
		    return this.pressed[keyCode];
		  },

		  onKeydown: function(event){
		    this.pressed[event.keyCode]=(new Date).getTime();
		  },

		  onKeyup: function(event){
		    delete this.pressed[event.keyCode];
		  }
		};

		window.addEventListener('keyup', function(event) { Key.onKeyup(event); }, false);
		window.addEventListener('keydown', function(event) { Key.onKeydown(event); }, false);

		Player = function(){
			this.x=300;
			this.y=300;
			this.r=SHIP_SIZE/2;
			this.vel = {
				x: 0,
				y: 0,
			};
			this.acc = {
				x: 0,
				y: 0
			};
			this.a = 90/180 * Math.PI;
			this.rot = 0;

			this.fire=false;

			this.init = function(ctx){
				this.ctx=ctx;
			};

			this.draw = function(){atom://teletype/portal/8fcb0450-410b-4a9a-ab6e-fc7bf20fdc66
				if (Key.isDown(Key.UP)) {
					//draw the thruster
					this.ctx.strokeStyle = "yellow";
					this.ctx.fillStyle = "red";
					this.ctx.lineWidth = SHIP_SIZE / 10;
					this.ctx.beginPath();

					this.ctx.moveTo(// rear left of the ship
						this.x - this.r * (2/3*Math.cos(this.a) + 0.5*Math.sin(this.a)),
						this.y + this.r * (2/3*Math.sin(this.a) - 0.5*Math.cos(this.a))
					);

					this.ctx.lineTo( //rear centre behind the ship behind
						this.x - this.r * 6/3*Math.cos(this.a),
						this.y + this.r * 6/3*Math.sin(this.a)
					);

					this.ctx.lineTo( //rear right of ship
						this.x - this.r * (2/3*Math.cos(this.a) - 0.5*Math.sin(this.a)),
						this.y + this.r * (2/3*Math.sin(this.a) + 0.5*Math.cos(this.a))
					);

					this.ctx.closePath();
					this.ctx.fillStyle = "red";

					this.ctx.stroke();
				}

				//draw triangular ship
				this.ctx.strokeStyle = "white";
				this.ctx.lineWidth = SHIP_SIZE / 20;
				this.ctx.beginPath();
				this.ctx.moveTo(// nose of the ship
					this.x + 4/3 * this.r * Math.cos(this.a),
					this.y - 4/3 * this.r * Math.sin(this.a)
				);

				this.ctx.lineTo( //rear left of ship
					this.x - this.r * (2/3*Math.cos(this.a) + Math.sin(this.a)),
					this.y + this.r * (2/3*Math.sin(this.a) - Math.cos(this.a))
				);

				this.ctx.lineTo( //rear right of ship
					this.x - this.r * (2/3*Math.cos(this.a) - Math.sin(this.a)),
					this.y + this.r * (2/3*Math.sin(this.a) + Math.cos(this.a))
				);

				this.ctx.closePath();

				this.ctx.stroke();

				//centre dot
				this.ctx.fillStyle = "red";
				this.ctx.fillRect(this.x - 1 + this.acc.x, this.y - 1 + this.acc.y, 2, 2);

			};

			this.update = function(){
				//requestAnimationFrame(draw);
				//If thrusting, adjust speed
				if (Key.isDown(Key.UP)) {

					if (Math.abs(this.acc.x) < MAX_ACC){
						this.acc.x += SHIP_THRUST * Math.cos(this.a)/FPS;
					}else{
						this.acc.x += 0;
					}

					if (Math.abs(this.acc.y) < MAX_ACC){
						this.acc.y += SHIP_THRUST * Math.sin(this.a)/FPS;
					}else{
						this.acc.y += 0;
					}

				}else {
					this.acc.x = 0;
					this.acc.y = 0;
				}

				//Move ship

				// trueVel=Math.sqrt(this.vel.x*this.vel.x + this.vel.y*this.vel.y);
				// if (trueVel <= MAX_SPEED){
				// 	this.vel.x += this.acc.x
				// 	this.vel.y -= this.acc.y
				// }

				if (Math.abs(this.vel.x) < MAX_SPEED){
					this.vel.x += this.acc.x;
				}else{
					this.vel.x = 3;
				}

				if (Math.abs(this.vel.y) < MAX_SPEED){
					this.vel.y -= this.acc.y;
				}else{
					this.vel.y += 3;
				}




				this.x += this.vel.x;
				this.y += this.vel.y;

				if (Key.isDown(Key.RIGHT)){
					this.rot = -TURN_SPEED/180*Math.PI/FPS
				}
				else{
					this.rot=0;
				}
				if (Key.isDown(Key.LEFT)){
					this.rot = TURN_SPEED/180*Math.PI/FPS
				}

				if (Key.isDown(Key.SPACE)){
					bull = new Bullet();
					bull.init(player);
					bulletList.push(bull);
				}

				//Adjust heading
				this.a += this.rot;

				//Handle screen edge TODO: fix cvs
				if (this.x < 0 - this.r){
					this.x = cvs.width + this.r;
				} else if (this.x > cvs.width + this.r){
					this.x = 0 - this.r;
				}
				if (this.y < 0 - this.r){
					this.y = cvs.height + this.r;
				} else if (this.y > cvs.height + this.r){
					this.y = 0 - this.r;
				}

				this.draw();
			};

		  /*this.init("player");
		  this.collidesWith = ["asteroid", "alien", "alienbullet"];
		  this.bulletCountDown = 60; //Countdown until a bullet can be fired
		  this.interact = function(){}; //detects for input and adjusts state as necessary*/
		};

		Bullet = function(){
		  this.x=0;
			this.y=0;
			this.rot=0;
			this.base=0;
			this.extraVel={
				x: 10,
				y: 10
			};

			this.draw = function(){
				this.ctx.arc(this.x, this.y, 5, 0, 2*Math.PI);
				this.ctx.stroke();
			};

			this.update = function(){
				this.x += (this.extraVel.x + this.base.x) * Math.cos(this.rot)/FPS;
				this.y += (this.extraVel.y + this.base.y) * Math.sin(this.rot)/FPS;
				this.draw();
			};

			this.init = function(ship){
				this.x=ship.x;
				this.y=ship.y;
				this.rot=ship.a;
				this.base=ship.vel;
				this.ctx=ship.ctx;

				if (this.base.x < 0){
					this.extraVel.x *= -2;
				}
				if (this.base.y < 0){
					this.extraVel.y *= -2;
				}
			};
		};

		//create bullets on space bar press, have some intial velocity and are relative to the ship
		//can only be a certain number4.08160117 of bullets on screen/bullets can only go so far

		//set up event handlers
		// document.addEventListener("keydown", keyDown);
		// document.addEventListener("keyup", keyUp);

		bulletList=[];
		player = new Player();
		player.init(ctx);

		//set up the game loop
		setInterval(update, 1000/FPS);

		// function keyDown(ev){
		// 	switch(ev.keyCode){
		// 		case 37: //left arrow (rotate ship left)
		// 			player.rot = TURN_SPEED/180*Math.PI/FPS; //converts turn speed to radians then gets per frame speed of that
		// 			break;
		// 		case 38: //up arrow (thrusts ship forward)
		// 			player.thrusting = true;
		// 			break;
		// 		case 39: //right arrow (rotate ship right)
		// 			player.rot = -TURN_SPEED/180*Math.PI/FPS;
		// 			break;
		// 		case 32: //spacebar press (fire bullet)
		// 			//bullet.rot = ship.rot;
		// 			player.fire =  true;
		// 			// firethrustX = ship.thrust.x;
		// 			// firethrustY = ship.thrust.y;
		// 			// shipPosX = ship.x;
		// 			// shipPosY = ship.y;
		// 			break;
		// 	}
		// }
		//
		// function keyUp(ev){
		// 	switch(ev.keyCode){
		// 		case 37: //left arrow (stop rotating ship left)
		// 			player.rot = 0; //converts turn speed to radians then gets per frame speed of that
		// 			break;
		// 		case 38: //up arrow (stop thrusting ship forward)
		// 			player.thrusting = false;
		// 			break;
		// 		case 39: //right arrow (stop rotating ship right)
		// 			player.rot = 0;
		// 			break;
		// 		case 32: //spacebar released (delay for next bullet before we set fire to false)
		// 			player.fire = false;
		// 			// bullet.thrust.x =0;
		// 			// bullet.thrust.y =0;
		// 			break;
		// 	}
		// }

		function update(){
			//draw space
			ctx.fillStyle = "black";
			ctx.fillRect(0,0,cvs.width, cvs.height);

			player.update();

			for (var i=0; i < bulletList.length; i++){
				bulletList[i].update();
			}

			// document.getElementById("output1").innerHTML=player.x; //bulletList.length;
			// document.getElementById("output2").innerHTML=player.y;
			document.getElementById("output3").innerHTML=Math.round(player.vel.x); //bulletList.length;
			document.getElementById("output4").innerHTML=Math.round(player.vel.y);
			document.getElementById("output5").innerHTML=Math.round(player.acc.x); //bulletList.length;
			document.getElementById("output6").innerHTML=Math.round(player.acc.y);
}
	</script>
	<p>
		<text id="output1"></text>
		<text id="output2"></text>
		<text id="output3"></text>
		<text id="output4"></text>
		<text id="output5"></text>
		<text id="output6"></text>
	</p>

</body>
</html>
